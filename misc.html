<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Misc. â€“ Maj Vestal</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%E2%9A%94%EF%B8%8F%3C/text%3E%3C/svg%3E" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="https://use.typekit.net/cyu8ase.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Great+Vibes&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="password-screen" class="password-screen" aria-label="Password required">
      <div class="password-screen-inner">
        <p class="password-screen-label">Password required</p>
        <form id="password-form" class="password-form" autocomplete="off">
          <input type="password" id="password-input" class="password-input" placeholder="Enter password" autocomplete="off" aria-label="Password" />
          <button type="submit" class="password-submit">Enter</button>
        </form>
        <p id="password-error" class="password-error" aria-live="polite" hidden>Incorrect password</p>
      </div>
    </div>
    <div class="page">
      <div class="site-header">
        <div class="site-header-inner">
          <a href="./index.html" class="brand brand-wordmark">Maj Vestal</a>
          <nav class="nav">
            <a class="nav-link" href="./index.html">Work</a>
            <a class="nav-link" href="info.html">Info</a>
            <a class="nav-link nav-active" href="misc.html">Misc.</a>
          </nav>
        </div>
      </div>
      <main class="page-main misc-page">
        <div id="misc-playground" class="misc-playground" role="application" aria-label="Draggable image playground"></div>
        <div id="misc-gallery" class="misc-gallery" role="list" aria-label="Mosaic gallery of all images" hidden></div>
        <div class="misc-view-switch-wrap">
          <div class="misc-view-switch" role="group" aria-label="View mode">
            <button type="button" id="misc-view-playground" class="misc-view-switch-option" aria-pressed="true" aria-label="Playground view">Playground</button>
            <button type="button" id="misc-view-gallery" class="misc-view-switch-option" aria-pressed="false" aria-label="Gallery view">Gallery</button>
          </div>
        </div>
        <div id="misc-lightbox" class="misc-lightbox" role="dialog" aria-modal="true" aria-label="Image preview" hidden>
          <button type="button" class="misc-lightbox-backdrop" aria-label="Close"></button>
          <div class="misc-lightbox-content">
            <button type="button" class="misc-lightbox-close" aria-label="Close">&times;</button>
            <div class="misc-lightbox-media"></div>
          </div>
        </div>
      </main>
    </div>
    <script>
      (function () {
        var KEY = "mv_portfolio";
        var PASS = "frog";
        var screen = document.getElementById("password-screen");
        var form = document.getElementById("password-form");
        var input = document.getElementById("password-input");
        var error = document.getElementById("password-error");
        if (sessionStorage.getItem(KEY) === PASS) {
          screen.classList.add("is-unlocked");
          return;
        }
        form.addEventListener("submit", function (e) {
          e.preventDefault();
          if (input.value === PASS) {
            sessionStorage.setItem(KEY, PASS);
            screen.classList.add("is-unlocked");
            error.hidden = true;
          } else {
            error.hidden = false;
            input.focus();
          }
        });
      })();

      (function () {
        var scrollThreshold = 80;
        function onScroll() {
          document.body.classList.toggle("is-scrolled", window.scrollY > scrollThreshold);
        }
        window.addEventListener("scroll", onScroll, { passive: true });
        onScroll();
      })();
      (function () {
        function initScrollIn() {
          var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
              if (entry.isIntersecting) entry.target.classList.add("is-visible");
            });
          }, { rootMargin: "0px 0px -5% 0px", threshold: 0 });
          document.querySelectorAll(".scroll-in").forEach(function (el) { observer.observe(el); });
        }
        setTimeout(initScrollIn, 140);
      })();

      (function () {
        var ctx = null;
        function playClick() {
          if (!ctx) {
            ctx = new (window.AudioContext || window.webkitAudioContext)();
          }
          if (ctx.state === "suspended") ctx.resume();
          var now = ctx.currentTime;
          function tick(t) {
            var osc = ctx.createOscillator();
            var gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = "square";
            osc.frequency.setValueAtTime(1800, t);
            osc.frequency.exponentialRampToValueAtTime(200, t + 0.008);
            gain.gain.setValueAtTime(0.018, t);
            gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.012);
            osc.start(t);
            osc.stop(t + 0.012);
          }
          tick(now);
          tick(now + 0.006);
        }
        document.querySelectorAll(".nav a, .brand").forEach(function (link) {
          link.addEventListener("mouseenter", playClick);
        });
      })();

      (function () {
        var PLACEHOLDER = "assets/case-study-placeholder.png";
        var DEFAULT_COUNT = 14;
        var DELAY_MS = 1120;
        var MISC_IMAGES = [
          "assets/misc/2CHA_UKNOW_1smalol.gif",
          "assets/misc/AdamArtwork_final%28ish%29.png",
          "assets/misc/alicegas.png",
          "assets/misc/Artboard%2016-100.jpg",
          "assets/misc/bananabread_color%20more%20noise.png",
          "assets/misc/Connectors%20colorful6.jpg",
          "assets/misc/cover.png",
          "assets/misc/crap-100.jpg",
          "assets/misc/cyberunderground.png",
          "assets/misc/fairy2.png",
          "assets/misc/fairymonster.gif",
          "assets/misc/figure%20drawing.png",
          "assets/misc/figure2.png",
          "assets/misc/figure6.png",
          "assets/misc/flowers.png",
          "assets/misc/frogfighter.gif",
          "assets/misc/illo.png",
          "assets/misc/illo2.png",
          "assets/misc/Illustration2.png",
          "assets/misc/Illustration5.jpg",
          "assets/misc/jetset%20radio%20girl_Cleanup6.png",
          "assets/misc/JuicyCD.png",
          "assets/misc/lottery.mp4",
          "assets/misc/me.png",
          "assets/misc/paitning.png",
          "assets/misc/pixmonshading.png",
          "assets/misc/scroll-stopping-creative.gif",
          "assets/misc/Screen%20Shot%202020-05-03%20at%208.04.58%20PM.png",
          "assets/misc/slack_5.mp4",
          "assets/misc/stickersanimate_small.gif",
          "assets/misc/Untitled_Artwork.gif"
        ];
        var playground = document.getElementById("misc-playground");
        var galleryEl = document.getElementById("misc-gallery");
        var btnPlayground = document.getElementById("misc-view-playground");
        var btnGallery = document.getElementById("misc-view-gallery");
        var currentImageList = [];
        var topZ = 1;
        var dragTarget = null;
        var dragOffsetX = 0;
        var dragOffsetY = 0;
        var dragCardW = 374;
        var dragCardH = 374;

        function getViewportBounds() {
          return { width: window.innerWidth, height: window.innerHeight };
        }

        function randomIn(min, max) {
          return min + Math.random() * (max - min);
        }

        function placePaper(paper) {
          var b = getViewportBounds();
          var cardW = paper.offsetWidth;
          var cardH = paper.offsetHeight;
          var pad = 20;
          var x = pad + randomIn(0, Math.max(0, b.width - cardW - pad * 2));
          var y = pad + randomIn(0, Math.max(0, b.height - cardH - pad * 2));
          var rot = randomIn(-14, 14);
          paper.style.transform = "translate3d(" + (x + cardW / 2) + "px," + (y + cardH / 2) + "px,0) rotate(" + rot + "deg)";
          paper.dataset.rotation = rot;
          paper.dataset.x = x;
          paper.dataset.y = y;
        }

        function getClientCoords(e) {
          if (e.touches && e.touches.length) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
          return { x: e.clientX, y: e.clientY };
        }

        function startDrag(paper, clientX, clientY) {
          paper.style.zIndex = ++topZ;
          dragTarget = paper;
          dragCardW = paper.offsetWidth;
          dragCardH = paper.offsetHeight;
          // Use stored position only (no getBoundingClientRect) so we don't trigger reflow or rounding differences
          var topLeftX = parseFloat(paper.dataset.x) || 0;
          var topLeftY = parseFloat(paper.dataset.y) || 0;
          var cx = topLeftX + dragCardW / 2;
          var cy = topLeftY + dragCardH / 2;
          var rot = parseFloat(paper.dataset.rotation) || 0;
          var rotRad = (rot * Math.PI) / 180;
          var cos = Math.cos(rotRad);
          var sin = Math.sin(rotRad);
          dragOffsetX = (clientX - cx) * cos + (clientY - cy) * sin + dragCardW / 2;
          dragOffsetY = -(clientX - cx) * sin + (clientY - cy) * cos + dragCardH / 2;
          // Lock transform before adding class so first click doesn't jump (avoids compositor rounding on new layer)
          paper.style.transform = "translate3d(" + cx + "px," + cy + "px,0) rotate(" + rot + "deg)";
          paper.classList.add("misc-paper-dragging");
          var siblings = playground.querySelectorAll(".misc-paper");
          for (var i = 0; i < siblings.length; i++) {
            if (siblings[i] !== paper) siblings[i].style.pointerEvents = "none";
          }
          document.addEventListener("mousemove", onMouseMove);
          document.addEventListener("mouseup", onMouseUp);
          document.addEventListener("touchmove", onTouchMove, { passive: false });
          document.addEventListener("touchend", onTouchEnd);
        }

        var rafId = null;
        function moveDrag(clientX, clientY) {
          if (!dragTarget) return;
          var rot = parseFloat(dragTarget.dataset.rotation) || 0;
          var rotRad = (rot * Math.PI) / 180;
          var cos = Math.cos(rotRad);
          var sin = Math.sin(rotRad);
          var dx = dragOffsetX - dragCardW / 2;
          var dy = dragOffsetY - dragCardH / 2;
          var cx = clientX - (dx * cos - dy * sin);
          var cy = clientY - (dx * sin + dy * cos);
          var w = window.innerWidth;
          var h = window.innerHeight;
          var halfW = dragCardW / 2;
          var halfH = dragCardH / 2;
          cx = Math.max(0, Math.min(w, cx));
          cy = Math.max(0, Math.min(h, cy));
          dragTarget.dataset.x = cx - halfW;
          dragTarget.dataset.y = cy - halfH;
          if (rafId != null) cancelAnimationFrame(rafId);
          rafId = requestAnimationFrame(function () {
            dragTarget.style.transform = "translate3d(" + cx + "px," + cy + "px,0) rotate(" + rot + "deg)";
            rafId = null;
          });
        }

        function endDrag() {
          if (rafId != null) {
            cancelAnimationFrame(rafId);
            rafId = null;
          }
          var papers = playground ? playground.querySelectorAll(".misc-paper") : [];
          for (var i = 0; i < papers.length; i++) papers[i].style.pointerEvents = "";
          if (dragTarget) {
            dragTarget.classList.remove("misc-paper-dragging");
            dragTarget = null;
          }
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", onMouseUp);
          document.removeEventListener("touchmove", onTouchMove);
          document.removeEventListener("touchend", onTouchEnd);
        }

        function onMouseDown(e) {
          if (e.button !== 0) return;
          var paper = e.target.closest(".misc-paper");
          if (!paper) return;
          e.preventDefault();
          startDrag(paper, e.clientX, e.clientY);
        }

        function onMouseMove(e) {
          e.preventDefault();
          moveDrag(e.clientX, e.clientY);
        }

        function onMouseUp() {
          endDrag();
        }

        function onTouchMove(e) {
          if (dragTarget && e.touches.length) {
            e.preventDefault();
            moveDrag(e.touches[0].clientX, e.touches[0].clientY);
          }
        }

        function onTouchEnd() {
          endDrag();
        }

        function addPaper(index, src) {
          var paper = document.createElement("div");
          paper.className = "misc-paper";
          paper.setAttribute("role", "img");
          paper.setAttribute("aria-label", "Misc work " + (index + 1));
          var isVideo = /\.(mp4|webm|mov)(\?|$)/i.test(src || "");
          if (isVideo) {
            var video = document.createElement("video");
            video.src = src;
            video.muted = true;
            video.loop = true;
            video.playsInline = true;
            video.autoplay = true;
            video.setAttribute("playsinline", "");
            paper.appendChild(video);
          } else {
            var img = document.createElement("img");
            img.src = src || PLACEHOLDER;
            img.alt = "";
            img.draggable = false;
            img.loading = "lazy";
            img.decoding = "async";
            paper.appendChild(img);
          }
          placePaper(paper);
          paper.style.zIndex = index + 1;
          topZ = Math.max(topZ, index + 1);
          playground.appendChild(paper);
          requestAnimationFrame(function () {
            paper.classList.add("is-visible");
          });
          paper.addEventListener("mousedown", onMouseDown);
          paper.addEventListener("touchstart", function (e) {
            if (e.touches.length !== 1) return;
            var p = e.target.closest(".misc-paper");
            if (!p) return;
            e.preventDefault();
            startDrag(p, e.touches[0].clientX, e.touches[0].clientY);
          }, { passive: false });
        }

        function run(imageList) {
          var list = imageList && imageList.length > 0 ? imageList : [];
          currentImageList = list.length > 0 ? list.slice() : MISC_IMAGES.slice();
          var count = currentImageList.length;
          for (var i = 0; i < count; i++) {
            (function (idx) {
              var src = currentImageList[idx] || PLACEHOLDER;
              setTimeout(function () { addPaper(idx, src); }, idx * DELAY_MS);
            })(i);
          }
        }

        var lightboxEl = document.getElementById("misc-lightbox");
        var lightboxMedia = lightboxEl ? lightboxEl.querySelector(".misc-lightbox-media") : null;
        var lightboxBackdrop = lightboxEl ? lightboxEl.querySelector(".misc-lightbox-backdrop") : null;
        var lightboxCloseBtn = lightboxEl ? lightboxEl.querySelector(".misc-lightbox-close") : null;

        function openLightbox(src, isVideo) {
          if (!lightboxEl || !lightboxMedia) return;
          while (lightboxMedia.firstChild) lightboxMedia.removeChild(lightboxMedia.firstChild);
          if (isVideo) {
            var v = document.createElement("video");
            v.src = src;
            v.muted = true;
            v.loop = true;
            v.playsInline = true;
            v.autoplay = true;
            v.controls = true;
            v.setAttribute("playsinline", "");
            lightboxMedia.appendChild(v);
          } else {
            var img = document.createElement("img");
            img.src = src || PLACEHOLDER;
            img.alt = "";
            lightboxMedia.appendChild(img);
          }
          lightboxEl.hidden = false;
          document.body.style.overflow = "hidden";
          if (lightboxCloseBtn) lightboxCloseBtn.focus();
        }

        function closeLightbox() {
          if (!lightboxEl || !lightboxMedia) return;
          var v = lightboxMedia.querySelector("video");
          if (v) v.pause();
          while (lightboxMedia.firstChild) lightboxMedia.removeChild(lightboxMedia.firstChild);
          lightboxEl.hidden = true;
          document.body.style.overflow = "";
        }

        function initLightbox() {
          if (lightboxBackdrop) lightboxBackdrop.addEventListener("click", closeLightbox);
          if (lightboxCloseBtn) lightboxCloseBtn.addEventListener("click", closeLightbox);
          document.addEventListener("keydown", function (e) {
            if (e.key === "Escape" && lightboxEl && !lightboxEl.hidden) closeLightbox();
          });
        }

        function buildGallery() {
          if (!galleryEl || galleryEl.children.length > 0) return;
          var list = currentImageList.length > 0 ? currentImageList : MISC_IMAGES;
          list.forEach(function (src, i) {
            var item = document.createElement("div");
            item.className = "misc-gallery-item";
            item.setAttribute("role", "listitem");
            item.setAttribute("tabindex", "0");
            var isVideo = /\.(mp4|webm|mov)(\?|$)/i.test(src || "");
            item.dataset.src = src || PLACEHOLDER;
            item.dataset.isVideo = isVideo ? "1" : "0";
            if (isVideo) {
              var video = document.createElement("video");
              video.src = src;
              video.muted = true;
              video.loop = true;
              video.playsInline = true;
              video.autoplay = true;
              video.setAttribute("playsinline", "");
              item.appendChild(video);
            } else {
              var img = document.createElement("img");
              img.src = src || PLACEHOLDER;
              img.alt = "";
              img.loading = "lazy";
              img.decoding = "async";
              item.appendChild(img);
            }
            item.addEventListener("click", function () {
              openLightbox(item.dataset.src, item.dataset.isVideo === "1");
            });
            item.addEventListener("keydown", function (e) {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                openLightbox(item.dataset.src, item.dataset.isVideo === "1");
              }
            });
            galleryEl.appendChild(item);
          });
        }

        function setGalleryView(active) {
          if (active) {
            buildGallery();
            galleryEl.hidden = false;
            if (playground) playground.setAttribute("aria-hidden", "true");
            document.body.classList.add("misc-gallery-view");
            if (btnPlayground) { btnPlayground.setAttribute("aria-pressed", "false"); }
            if (btnGallery) { btnGallery.setAttribute("aria-pressed", "true"); }
          } else {
            galleryEl.hidden = true;
            if (playground) playground.removeAttribute("aria-hidden");
            document.body.classList.remove("misc-gallery-view");
            if (btnPlayground) { btnPlayground.setAttribute("aria-pressed", "true"); }
            if (btnGallery) { btnGallery.setAttribute("aria-pressed", "false"); }
          }
        }

        function initToggle() {
          if (btnPlayground) btnPlayground.addEventListener("click", function () { setGalleryView(false); });
          if (btnGallery) btnGallery.addEventListener("click", function () { setGalleryView(true); });
        }

        function start() {
          initToggle();
          initLightbox();
          fetch("./content.json?t=" + Date.now())
            .then(function (r) { return r.ok ? r.json() : null; })
            .then(function (data) {
              var list = data && data.miscImages && Array.isArray(data.miscImages) && data.miscImages.length > 0
                ? data.miscImages
                : MISC_IMAGES;
              run(list);
            })
            .catch(function () { run(MISC_IMAGES); });
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", start);
        } else {
          start();
        }
      })();
    </script>
    <script src="content-loader.js"></script>
  </body>
</html>
